pipeline {
    agent any
    stages {
        stage('Checkout matter_github_jenkins and run') {
            steps {
                script {
                    checkout scm: [$class                    : 'GitSCM',
                            branches                         : scm.branches,
                            browser                          : [$class: 'Stash', repoUrl: 'https://stash.silabs.com/projects/WMN_TOOLS/repos/matter_extension/'],
                            doGenerateSubmoduleConfigurations: scm.doGenerateSubmoduleConfigurations,
                            extensions                       : [[$class: 'ScmName', name: 'matter_extension']],
                            userRemoteConfigs                : scm.userRemoteConfigs]   
        
                    sh """
                        git submodule update --init  --checkout third_party/matter_github_jenkins
                        cd third_party/matter_github_jenkins
                        git checkout feature/github_jenkins_integration
                    """

                    matter_github_jenkins_pipeline = load 'third_party/matter_github_jenkins/Jenkinsfile'

                    matter_github_jenkins_pipeline.run_pipeline()
                }
            }
        }
    }
}