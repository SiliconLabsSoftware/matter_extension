name: Trigger Dev Apps Build on Non-Default Branches

on:
  schedule:
    - cron: '0 2 * * *' # 9 pm EST daily

permissions:
  actions: write
  contents: read

jobs:
  trigger_dev_apps_build:
    name: Trigger Daily Dev Apps Build
    runs-on: ubuntu-latest
    strategy:
      matrix:
        branch: [release_2.8-1.5] 

    steps:
      - name: Trigger Dev Apps Build on ${{ matrix.branch }}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: ${{ matrix.branch }}
          BUILD_TYPE: 'full'
        run: |
          echo "Triggering dev-apps-builder.yaml on branch $BRANCH with build-type $BUILD_TYPE"
          
          response=$(curl -s -w "%{http_code}" -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $GH_TOKEN" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "https://api.github.com/repos/${{ github.repository }}/actions/workflows/dev-apps-builder.yaml/dispatches" \
            -d "{\"ref\":\"$BRANCH\",\"inputs\":{\"build-type\":\"$BUILD_TYPE\"}}")
          
          http_code="${response: -3}"
          response_body="${response%???}"
          
          if [ "$http_code" = "204" ]; then
            echo "Successfully triggered dev-apps-builder.yaml on $BRANCH"
            echo "Build type: $BUILD_TYPE"
            echo "Timestamp: $(date -u)"
          else
            echo "Failed to trigger workflow. HTTP code: $http_code"
            echo "Response: $response_body"
            exit 1
          fi