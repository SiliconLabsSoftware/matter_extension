name: Build Dev apps

on:
    workflow_call:
        inputs:
            build-type:
                description: "The build type to use"
                required: true
                type: string

jobs:
    build-lighting-app:
        name: Build Lighting App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "lighting-app"
            build-type: ${{ inputs.build-type }}

    build-air-quality-sensor-app:
        name: Build Air Quality Sensor App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "air-quality-sensor-app"
            build-type: ${{ inputs.build-type }}

    build-light-switch-app:
        name: Build Light Switch App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "light-switch-app"
            build-type: ${{ inputs.build-type }}

    build-lock-app:
        name: Build Lock App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "lock-app"
            build-type: ${{ inputs.build-type }}
            ncp-917-support: true
            ncp-wf200-support: true
            ncp-rs911x-support: true

    build-thermostat-app:
        name: Build Thermostat App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "thermostat"
            build-type: ${{ inputs.build-type }}
            ncp-917-support: true
            ncp-wf200-support: true
            ncp-rs911x-support: true

    build-window-app:
        name: Build Window App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "window-app"
            build-type: ${{ inputs.build-type }}
            ncp-917-support: true

    build-fan-control-app:
        name: Build Fan Control App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "fan-control-app"
            build-type: ${{ inputs.build-type }}
            thread-support: false

    build-multi-sensor-app:
        name: Build Multi Sensor App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "multi-sensor-app"
            build-type: ${{ inputs.build-type }}

    build-onoff-plug-app:
        name: Build OnOff Plug App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "onoff-plug-app"
            build-type: ${{ inputs.build-type }}
    
    build-refrigerator-app:
        name: Build Refrigerator App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "refrigerator-app"
            build-type: ${{ inputs.build-type }}
            ncp-917-support: false
            ncp-wf200-support: false
            ncp-rs911x-support: false
    
    build-performance-test-app:
        name: Build Performance Test App
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "performance-test-app"
            build-type: ${{ inputs.build-type }}
            ncp-917-support: false
            ncp-wf200-support: false
            ncp-rs911x-support: false
            wifi-soc-support: false

    # build-zigbee-matter-light-app:
    #     name: Build Zigbee Matter Light App
    #     needs: set-build-type
    #     uses: ./.github/workflows/platform-builder.yaml
    #     with:
    #         example-app: "zigbee-matter-light"
    #         build-type: ${{ inputs.build-type }}
    #         thread-keyword: ""
    #         ncp-917-support: false
    #         ncp-wf200-support: false
    #         ncp-rs911x-support: false
    #         wifi-soc-support: false

    build-bootloaders:
        name: Build Bootloaders
        uses: ./.github/workflows/platform-builder.yaml
        with:
            example-app: "matter-bootloader"
            build-type: ${{ inputs.build-type }}
            wifi-soc-support: false
    
    merge-apps:
        name: Merge App Artifacts
        runs-on: ubuntu-latest
        needs:
            - build-bootloaders
            - build-lighting-app
            - build-air-quality-sensor-app
            - build-light-switch-app
            - build-lock-app
            - build-thermostat-app
            - build-window-app
            - build-fan-control-app
            - build-multi-sensor-app
            - build-onoff-plug-app
            - build-refrigerator-app
            - build-performance-test-app
            # - build-zigbee-matter-light-app
        if: success()

        steps:
            - name: Merge artifacts
              uses: actions/upload-artifact/merge@v4
              with:
                name: "sample-apps-${{ inputs.build-type }}"
                delete-merged: true
                pattern: "*-${{ inputs.build-type }}"